# MinifyAI — система учёта личных финансов

MinifyAI — это комплексное решение для учёта доходов и расходов с поддержкой
рекуррентных подписок, аналитики, мультивалютности и AI-советника. Репозиторий
содержит PWA-фронтенд на React и backend на NestJS/Prisma, соответствующие
требованиям технического задания.

## Ключевые возможности

- Ежемесячный учёт трат с разбивкой по дням, категориям и мерчантам.
- Ручной ввод операций с быстрыми пресетами и поддержкой расходов/доходов/переводов.
- Управление подписками с CRUD, прогнозом платежей и настройкой напоминаний.
- Календарь с дневными агрегатами и переходом к детализации.
- Адаптивный интерфейс (мобильный/планшет/desktop) с PWA-возможностями.
- Чат с AI для советов по бюджету, автокатегоризации и объяснения аномалий.
- Мультивалюта с хранением курса на дату операции.

## Архитектура решения

## Структура репозитория

```
.
├── frontend/           # PWA-клиент на React + Vite
│   ├── src/
│   │   ├── components/ # общие элементы layout (Sidebar, TopBar, ActionBar)
│   │   ├── features/   # экранные модули: дашборды, календарь, подписки, чат, админка
│   │   ├── store/      # Zustand-сторы с моковыми данными и действиями
│   │   ├── utils/, types/ и styles/ для вспомогательных функций и типов
│   │   └── main.tsx    # входная точка SPA с роутингом `/user` и `/admin`
│   ├── public/         # manifest, sw.js, статические ассеты
│   └── package.json    # зависимости и команды фронтенда
├── backend/            # NestJS-приложение с Prisma и Swagger
│   ├── src/
│   │   ├── auth/, transactions/, subscriptions/, analytics/, chat/
│   │   │   └── *.controller|service.ts — REST API, реализующее требования ТЗ
│   │   ├── common/     # PrismaModule/PrismaService для подключения к БД
│   │   └── main.ts     # точка входа NestJS, настройка Swagger
│   ├── prisma/         # schema.prisma, миграции
│   └── package.json    # зависимости и команды backend
├── docs/               # документация, включая отчёт о выполнении ТЗ
└── README.md           # текущее руководство и описание проекта
```

Разделение на фронтенд и бэкенд полностью автономное: у каждого пакета своя
`package.json`, свои команды разработки и свои конфигурационные файлы. Общение
между ними предполагается через REST API, описанное в Swagger.

### Frontend (`frontend/`)

- **Стек:** React + TypeScript + Vite, React Router, React Query, Zustand.
- **UI:** стековый layout в стиле glassmorphism, компоненты для аналитики,
  календаря, подписок, AI-чата и административной панели.
- **PWA:** `manifest.json`, сервис-воркер (`public/sw.js`) и регистрация (`src/serviceWorkerRegistration.ts`).
- **Данные:** моковые стора на Zustand (`src/store`) имитируют ответы API до
  подключения реального backend.

### Backend (`backend/`)

- **Фреймворк:** NestJS + TypeScript.
- **ORM:** Prisma c PostgreSQL, схема описана в `backend/prisma/schema.prisma`.
- **Модули:** `auth`, `transactions`, `subscriptions`, `analytics`, `chat`.
- **Документация:** Swagger подключён в `backend/src/main.ts` и доступен на `/docs`.
- **Общие сервисы:** `PrismaService` и `PrismaModule` предоставляют доступ к БД во всех модулях.

### Инфраструктура (планируется)

- Docker Compose/Kubernetes, Terraform, GitHub Actions, Prometheus + Grafana.
- Интеграция с внешними валютными API (ECB) и Redis для кеширования.

## Настройка окружения

### Требования

- Node.js 18+
- npm 9+
- PostgreSQL 14+

## Пошаговое развертывание проекта

1. **Клонируйте репозиторий и перейдите в директорию проекта.**

   ```bash
   git clone <URL_репозитория>
   cd minifyAi
   ```

2. **Установите зависимости backend-приложения.**

   ```bash
   cd backend
   npm install
   ```

3. **Сконфигурируйте подключение к базе данных.**

   - Скопируйте пример конфигурации и при необходимости отредактируйте:

     ```bash
     cp .env.example .env
     ```

   - Убедитесь, что в `DATABASE_URL` указаны корректные реквизиты PostgreSQL.

4. **Создайте базу данных и примените схему Prisma.**

   ```bash
   createdb minifyai            # если база ещё не создана
   npx prisma migrate dev
   npx prisma generate
   ```

   > Если `createdb` недоступна, создайте базу через `psql` или GUI-клиент.

5. **Запустите backend в режиме разработки.**

   ```bash
   npm run start:dev
   ```

   Сервер будет доступен на `http://localhost:3000`, документация Swagger — на
   `http://localhost:3000/docs`.

6. **В новом терминале установите зависимости фронтенда.**

   ```bash
   cd ../frontend
   npm install
   ```

7. **Запустите фронтенд-PWA.**

   ```bash
   npm run dev
   ```

   Клиентское приложение откроется на `http://localhost:5173`. Используйте
   маршруты `/user` для личного кабинета и `/admin` для административной панели.

8. **(Опционально) Настройте прокси или переменные окружения для API.**

   По умолчанию фронтенд использует моковые данные из Zustand-сторов. Чтобы
   переключиться на реальный API, добавьте клиент к бекенду и настройте обращения
   к `http://localhost:3000` (например, через React Query).

9. **Проверьте работу ключевых сценариев.**

   - Создание и редактирование транзакций через форму.
   - Управление подписками и просмотр прогноза.
   - Просмотр аналитики, календаря и AI-чата.
   - Доступ к разделу `/admin` для проверки административных виджетов.

Следуя этим шагам, вы получите запущенный локально backend и PWA-клиент.

#### Где настраиваются конфиги для БД

1. **Переменные окружения** — файл `backend/.env` (создаётся из
   `backend/.env.example`). Ключевая переменная:

   ```env
   DATABASE_URL="postgresql://postgres:postgres@localhost:5432/minifyai"
   ```

2. **Схема данных** — файл `backend/prisma/schema.prisma`. Здесь описаны модели
   пользователей, транзакций, подписок, курсов валют и т.д. Изменения схемы
   применяются через `npx prisma migrate dev` или `npm run prisma:migrate`.

3. **Сервис доступа к БД** — `backend/src/common/prisma.service.ts`. В этом
   классе конфигурируется клиент Prisma, используемый во всех модулях NestJS.

При необходимости смены БД или настроек подключения модифицируйте `.env`,
обновите `schema.prisma`, а затем выполните миграции.

### Миграции БД

```bash
npm run prisma:migrate
```

Команда применит миграции к базе, указанной в `DATABASE_URL`. Для генерации
новой миграции обновите `schema.prisma` и выполните `npx prisma migrate dev --name <название>`.

## Статус соответствия ТЗ

Подробный разбор выполненных и запланированных пунктов находится в
`docs/tz-compliance.md`.

## Дальнейшие шаги

- Подключить реальные API валют и Redis для кеширования.
- Добавить офлайн-режим и push-уведомления в PWA.
- Внедрить AI-интеграцию (OpenAI) и инструменты автокатегоризации.
- Подготовить инфраструктурные манифесты и CI/CD.

